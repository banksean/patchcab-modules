import{Faceplate as t,Patch as n}from"/js/core.js";import{Fader as e}from"@banksean/patchcab-ui";function _(t,n,e){const _=t.slice();return _[8]=n[e],_[9]=n,_[10]=e,_}function s(t){let _,s,o,a,r;function i(n){t[6](n,t[10])}let l={y:10,x:48*(t[10]+1),min:0,max:1,precision:2,label:"H"+(t[10]+1)};return void 0!==t[0].partials[t[10]]&&(l.value=t[0].partials[t[10]]),_=new e({props:l}),__sv.binding_callbacks.push((()=>__sv.bind(_,"value",i))),a=new n({props:{x:48*(t[10]+1)+8,y:250,name:"partial-"+t[10],input:t[3][t[10]]}}),{c(){__sv.create_component(_.$$.fragment),o=__sv.space(),__sv.create_component(a.$$.fragment)},m(t,n){__sv.mount_component(_,t,n),__sv.insert(t,o,n),__sv.mount_component(a,t,n),r=!0},p(n,e){t=n;const o={};!s&&1&e&&(s=!0,o.value=t[0].partials[t[10]],__sv.add_flush_callback((()=>s=!1))),_.$set(o)},i(t){r||(__sv.transition_in(_.$$.fragment,t),__sv.transition_in(a.$$.fragment,t),r=!0)},o(t){__sv.transition_out(_.$$.fragment,t),__sv.transition_out(a.$$.fragment,t),r=!1},d(t){__sv.destroy_component(_,t),t&&__sv.detach(o),__sv.destroy_component(a,t)}}}function o(t){let o,a,c,u,v,p,m,f,$;function d(n){t[5](n)}let g={y:10,x:0,min:i,max:l,steps:500,label:"f"};void 0!==t[0].fundamental&&(g.value=t[0].fundamental),a=new e({props:g}),__sv.binding_callbacks.push((()=>__sv.bind(a,"value",d)));let y=t[0].partials,h=[];for(let n=0;n<y.length;n+=1)h[n]=s(_(t,y,n));const b=t=>__sv.transition_out(h[t],1,1,(()=>{h[t]=null}));return p=new n({props:{x:28,y:290,name:"in-cv",input:t[2],onConnect:t[4]}}),f=new n({props:{label:"out",x:48*(r+1),y:330,name:"out-cv",output:t[1]}}),{c(){o=__sv.element("partials"),__sv.create_component(a.$$.fragment),u=__sv.space();for(let t=0;t<h.length;t+=1)h[t].c();v=__sv.space(),__sv.create_component(p.$$.fragment),m=__sv.space(),__sv.create_component(f.$$.fragment),__sv.attr(o,"class","svelte-wo81ky")},m(t,n){__sv.insert(t,o,n),__sv.mount_component(a,o,null),__sv.append(o,u);for(let t=0;t<h.length;t+=1)h[t].m(o,null);__sv.insert(t,v,n),__sv.mount_component(p,t,n),__sv.insert(t,m,n),__sv.mount_component(f,t,n),$=!0},p(t,n){const e={};if(!c&&1&n&&(c=!0,e.value=t[0].fundamental,__sv.add_flush_callback((()=>c=!1))),a.$set(e),9&n){let e;for(y=t[0].partials,e=0;e<y.length;e+=1){const a=_(t,y,e);h[e]?(h[e].p(a,n),__sv.transition_in(h[e],1)):(h[e]=s(a),h[e].c(),__sv.transition_in(h[e],1),h[e].m(o,null))}for(__sv.group_outros(),e=y.length;e<h.length;e+=1)b(e);__sv.check_outros()}const r={};2&n&&(r.output=t[1]),f.$set(r)},i(t){if(!$){__sv.transition_in(a.$$.fragment,t);for(let t=0;t<y.length;t+=1)__sv.transition_in(h[t]);__sv.transition_in(p.$$.fragment,t),__sv.transition_in(f.$$.fragment,t),$=!0}},o(t){__sv.transition_out(a.$$.fragment,t),h=h.filter(Boolean);for(let t=0;t<h.length;t+=1)__sv.transition_out(h[t]);__sv.transition_out(p.$$.fragment,t),__sv.transition_out(f.$$.fragment,t),$=!1},d(t){t&&__sv.detach(o),__sv.destroy_component(a),__sv.destroy_each(h,t),t&&__sv.detach(v),__sv.destroy_component(p,t),t&&__sv.detach(m),__sv.destroy_component(f,t)}}}function a(n){let e,_;return e=new t({props:{title:"ADDITIVE OSC",color:"#1D1E22",$$slots:{default:[o]},$$scope:{ctx:n}}}),{c(){__sv.create_component(e.$$.fragment)},m(t,n){__sv.mount_component(e,t,n),_=!0},p(t,[n]){const _={};2051&n&&(_.$$scope={dirty:n,ctx:t}),e.$set(_)},i(t){_||(__sv.transition_in(e.$$.fragment,t),_=!0)},o(t){__sv.transition_out(e.$$.fragment,t),_=!1},d(t){__sv.destroy_component(e,t)}}}const r=16,i=20,l=200;function c(t,n,e){let{state:_={partials:Array(r).fill(0).map((()=>Math.random())),fundamental:0}}=n;const s=new Tone.Oscillator(_.fundamental).start();s.partialCount=r;const o=new Tone.Signal,a=Array(r).fill(0).map((()=>new Tone.Scale(0,1)));return t.$$set=t=>{"state"in t&&e(0,_=t.state)},t.$$.update=()=>{1&t.$$.dirty&&e(1,s.frequency.value=_.fundamental,s),1&t.$$.dirty&&e(1,s.partials=[..._.partials.map(((t,n)=>t))],s)},e(1,s.type="custom",s),[_,s,o,a,t=>{t?o.connect(s.frequency):(o.disconnect(s.frequency),e(1,s.frequency.overridden=!1,s),e(1,s.frequency.value=_.fundamental,s))},function(n){t.$$.not_equal(_.fundamental,n)&&(_.fundamental=n,e(0,_))},function(n,s){t.$$.not_equal(_.partials[s],n)&&(_.partials[s]=n,e(0,_))}]}class u extends __sv.SvelteComponent{constructor(t){var n;super(),document.getElementById("svelte-wo81ky-style")||((n=__sv.element("style")).id="svelte-wo81ky-style",n.textContent="partials.svelte-wo81ky{position:absolute;top:40px;left:20px}",__sv.append(document.head,n)),__sv.init(this,t,c,a,__sv.safe_not_equal,{state:0})}}export default u;
